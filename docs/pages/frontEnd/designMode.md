# è®¾è®¡æ¨¡å¼

ä¸ºä»€ä¹ˆè¦å­¦è®¾è®¡æ¨¡å¼ï¼Ÿ
ä»£ç å…¶å®žéƒ½ä¸æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œéœ€è¦é‡å¤çš„è¿­ä»£ã€‚
è®¾è®¡æ¨¡å¼çš„æœ€ç»ˆç›®çš„ï¼Œæ˜¯èƒ½è®©æˆ‘ä»¬çš„ä»£ç æ›´åŠ çš„å¥å£®ï¼Œå¯ç»´æŠ¤å¯æ‰©å±•æ€§æ›´å¥½ã€‚
å‰ç«¯å¹¶ä¸éœ€è¦æŽŒæ¡å…¨éƒ¨çš„ 23 ç§ï¼Œåªéœ€è¦æŽŒæ¡å¸¸ç”¨ï¼Œä¸”èƒ½ç”¨çš„ä¸€äº›
é“ï¼šäº”å¤§åŽŸåˆ™ï¼ŒSOLID è®¾è®¡åŽŸåˆ™
æœ¯ï¼šå°±åƒä¸€äº›å›ºå®šçš„å…¬å¼ï¼Œä¾‹å¦‚å‹¾è‚¡å®šç†

## SOLID è®¾è®¡åŽŸåˆ™

1. å•ä¸€åŠŸèƒ½åŽŸåˆ™ï¼ˆé‡ç‚¹ï¼‰
2. å¼€æ”¾å°é—­åŽŸåˆ™ï¼ˆé‡ç‚¹ï¼‰
3. é‡Œå¼æ›¿æ¢åŽŸåˆ™
4. æŽ¥å£éš”ç¦»åŽŸåˆ™
5. ä¾èµ–åè½¬åŽŸåˆ™

## ä¸‰ç§ç±»åž‹

1. åˆ›å»ºåž‹
2. ç»“æž„åž‹
3. è¡Œä¸ºåž‹

## ç®€å•çš„å·¥åŽ‚æ¨¡å¼

1. ç®€å•çš„å·¥åŽ‚æ¨¡å¼ï¼Œå°±æ˜¯ä¸ºäº†å®žçŽ°æ— è„‘çš„ä¼ å‚

```js
function Factory(name, age, career, work) {
  return new User(name, age, career, work)
}

// ä¸åŒçš„å·¥ç§ï¼Œæ‰€åšçš„äº‹æƒ…ä¸ä¸€æ ·
function User(name, age, career, work) {
  this.workMap = new Map([
    ["coder", ["å†™ä»£ç ", "å†™ç³»åˆ†", "ä¿®Bug"]],
    ["productManager", ["è®¢ä¼šè®®å®¤", "å†™PRD", "å‚¬æ›´"]],
    ["boss", ["å–èŒ¶", "çœ‹æŠ¥", "è§å®¢æˆ·"]],
  ])
  this.name = name
  this.age = age
  this.career = career
  this.work = workMap.get(work) || []
}
```

2. å·¥åŽ‚æ¨¡å¼å…¶å®žå°±æ˜¯å°†åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹å•ç‹¬å°è£…ï¼Œå¾ˆåƒæˆ‘ä»¬ç‚¹èœï¼Œåˆ¶ä½œè¿‡ç¨‹æˆ‘ä»¬ä¸å¿…å…³å¿ƒ

## æŠ½è±¡å·¥åŽ‚æ¨¡å¼

1. çº¦æŸæŠ½è±¡ç±»ï¼ˆAbstract Factoryï¼‰

```js
// çº¦å®šä¸€éƒ¨æ‰‹æœºçš„ç»„æˆ
class MobilePhoneFactory {
  // æä¾›æ“ä½œç³»ç»Ÿçš„æŽ¥å£
  createOS() {
    throw new Error("æŠ½è±¡å·¥åŽ‚æ–¹æ³•ä¸å…è®¸ç›´æŽ¥è°ƒç”¨ï¼Œä½ éœ€è¦å°†æˆ‘é‡å†™ï¼")
  }
  // æä¾›ç¡¬ä»¶çš„æŽ¥å£
  createHardWare() {
    throw new Error("æŠ½è±¡å·¥åŽ‚æ–¹æ³•ä¸å…è®¸ç›´æŽ¥è°ƒç”¨ï¼Œä½ éœ€è¦å°†æˆ‘é‡å†™ï¼")
  }
}
```

2. åŒ–æŠ½è±¡ä¸ºå…·ä½“

```js
// æˆ‘ä»¬éœ€è¦ç”Ÿæˆä¸€ä¸ª Android ç³»ç»Ÿ + é«˜é€šç¡¬ä»¶çš„æ‰‹æœº
// å…·ä½“å·¥åŽ‚ç»§æ‰¿è‡ªæŠ½è±¡å·¥åŽ‚
class FakeStarFactory extends MobilePhoneFactory {
  createOS() {
    // æä¾›å®‰å“ç³»ç»Ÿå®žä¾‹
    return new AndroidOS()
  }
  createHardWare() {
    // æä¾›é«˜é€šç¡¬ä»¶å®žä¾‹
    return new QualcommHardWare()
  }
}
// é‚£å…¶å®žè½¯ä»¶å’Œç¡¬ä»¶æ˜¯åŒä¸€ä¸ªé“ç†
// å®šä¹‰æ“ä½œç³»ç»Ÿè¿™ç±»äº§å“çš„æŠ½è±¡äº§å“ç±»
class OS {
  controlHardWare() {
    throw new Error("æŠ½è±¡äº§å“æ–¹æ³•ä¸å…è®¸ç›´æŽ¥è°ƒç”¨ï¼Œä½ éœ€è¦å°†æˆ‘é‡å†™ï¼")
  }
}

// å®šä¹‰å…·ä½“æ“ä½œç³»ç»Ÿçš„å…·ä½“äº§å“ç±»
class AndroidOS extends OS {
  controlHardWare() {
    console.log("æˆ‘ä¼šç”¨å®‰å“çš„æ–¹å¼åŽ»æ“ä½œç¡¬ä»¶")
  }
}

class AppleOS extends OS {
  controlHardWare() {
    console.log("æˆ‘ä¼šç”¨ðŸŽçš„æ–¹å¼åŽ»æ“ä½œç¡¬ä»¶")
  }
}

// å®šä¹‰æ‰‹æœºç¡¬ä»¶è¿™ç±»äº§å“çš„æŠ½è±¡äº§å“ç±»
class HardWare {
  // æ‰‹æœºç¡¬ä»¶çš„å…±æ€§æ–¹æ³•ï¼Œè¿™é‡Œæå–äº†â€œæ ¹æ®å‘½ä»¤è¿è½¬â€è¿™ä¸ªå…±æ€§
  operateByOrder() {
    throw new Error("æŠ½è±¡äº§å“æ–¹æ³•ä¸å…è®¸ç›´æŽ¥è°ƒç”¨ï¼Œä½ éœ€è¦å°†æˆ‘é‡å†™ï¼")
  }
}

// å®šä¹‰å…·ä½“ç¡¬ä»¶çš„å…·ä½“äº§å“ç±»
class QualcommHardWare extends HardWare {
  operateByOrder() {
    console.log("æˆ‘ä¼šç”¨é«˜é€šçš„æ–¹å¼åŽ»è¿è½¬")
  }
}

class MiWare extends HardWare {
  operateByOrder() {
    console.log("æˆ‘ä¼šç”¨å°ç±³çš„æ–¹å¼åŽ»è¿è½¬")
  }
}
// è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¾ˆè½»æ¾çš„ç»„è£…å®‰å“æ‰‹æœºäº†
const myMobile = FakeStarFactory()
// è®¾å¤‡å…ˆæ‹¥æœ‰é«˜é€šcpu
const myHardWare = myMobile.createHardWare()
// æ‹¥æœ‰å®‰å“çš„æ“ä½œç³»ç»Ÿ
const myOS = myMobile.createOS()
// å”¤é†’ç¡¬ä»¶(è¾“å‡ºâ€˜æˆ‘ä¼šç”¨é«˜é€šçš„æ–¹å¼åŽ»è¿è½¬â€™)
myHardWare.operateByOrder()
// å¯åŠ¨æ“ä½œç³»ç»Ÿ(è¾“å‡ºâ€˜æˆ‘ä¼šç”¨å®‰å“çš„æ–¹å¼åŽ»æ“ä½œç¡¬ä»¶â€™)
myOS.controlHardWare()
```

3. å°è£…æŠ½è±¡çš„å¥½å¤„

```js
// å…³é”®çš„æ—¶åˆ»æ¥äº†â€”â€”å‡å¦‚æœ‰ä¸€å¤©ï¼ŒFakeStarè¿‡æ°”äº†ï¼Œæˆ‘ä»¬éœ€è¦äº§å‡ºä¸€æ¬¾æ–°æœºæŠ•å…¥å¸‚åœºï¼Œè¿™æ—¶å€™æ€Žä¹ˆåŠžï¼Ÿ
// æˆ‘ä»¬æ˜¯ä¸æ˜¯ä¸éœ€è¦å¯¹æŠ½è±¡å·¥åŽ‚MobilePhoneFactoryåšä»»ä½•ä¿®æ”¹ï¼Œåªéœ€è¦æ‹“å±•å®ƒçš„ç§ç±»ï¼š
class newStarFactory extends MobilePhoneFactory {
  createOS() {
    // æ“ä½œç³»ç»Ÿå®žçŽ°ä»£ç 
  }
  createHardWare() {
    // ç¡¬ä»¶å®žçŽ°ä»£ç 
  }
}
// è¿™ä¹ˆä¸ªæ“ä½œï¼Œå¯¹åŽŸæœ‰çš„ç³»ç»Ÿä¸ä¼šé€ æˆä»»ä½•æ½œåœ¨å½±å“ æ‰€è°“çš„â€œå¯¹æ‹“å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­â€å°±è¿™ä¹ˆåœ†æ»¡å®žçŽ°äº†ã€‚
// å‰é¢æˆ‘ä»¬ä¹‹æ‰€ä»¥è¦å®žçŽ°æŠ½è±¡äº§å“ç±»ï¼Œä¹Ÿæ˜¯åŒæ ·çš„é“ç†ã€‚
```

4. æŠ½è±¡å·¥åŽ‚å’Œç®€å•å·¥åŽ‚

- ç®€å•å·¥åŽ‚çš„ä½¿ç”¨åœºæ™¯é‡Œï¼Œå¤„ç†çš„å¯¹è±¡æ˜¯ç±»ï¼Œå¹¶ä¸”æ˜¯ä¸€äº›éžå¸¸å¥½å¯¹ä»˜çš„ç±»â€”â€”å®ƒä»¬çš„å…±æ€§å®¹æ˜“æŠ½ç¦»ï¼ŒåŒæ—¶å› ä¸ºé€»è¾‘æœ¬èº«æ¯”è¾ƒç®€å•ï¼Œæ•…è€Œä¸è‹›æ±‚ä»£ç å¯æ‰©å±•æ€§ã€‚
- æŠ½è±¡å·¥åŽ‚æœ¬è´¨ä¸Šå¤„ç†çš„å…¶å®žä¹Ÿæ˜¯ç±»ï¼Œä½†æ˜¯æ˜¯ä¸€å¸®éžå¸¸æ£˜æ‰‹ã€ç¹æ‚çš„ç±»ï¼Œè¿™äº›ç±»ä¸­ä¸ä»…èƒ½åˆ’åˆ†å‡ºé—¨æ´¾ï¼Œè¿˜èƒ½åˆ’åˆ†å‡ºç­‰çº§ï¼ŒåŒæ—¶å­˜åœ¨ç€åƒå˜ä¸‡åŒ–çš„æ‰©å±•å¯èƒ½æ€§ã€‚
- æŠ½è±¡å·¥åŽ‚æ¨¡å¼çš„å®šä¹‰ï¼Œæ˜¯å›´ç»•ä¸€ä¸ªè¶…çº§å·¥åŽ‚åˆ›å»ºå…¶ä»–å·¥åŽ‚ã€‚
- æ¯”å¦‚æ‰‹æœºï¼ˆæŠ½è±¡å·¥åŽ‚ï¼‰- å®‰å“æ‰‹æœºï¼ˆå…·ä½“å·¥åŽ‚ï¼‰- æŠ½è±¡äº§å“ï¼ˆæ¯”å¦‚ç¡¬ä»¶ï¼Œæ“ä½œç³»ç»Ÿï¼‰- å°ç±³æ‰‹æœºï¼ˆå…·ä½“äº§å“ï¼‰

## å•ä¾‹æ¨¡å¼

1. å®šä¹‰
   ä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®žä¾‹ï¼Œå¹¶ä¸”ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹ã€‚
2. å®žçŽ°

```js
var Singleton = function (name) {
  this.name = name
  this.instance = null
}
Singleton.prototype.getName = function (name) {
  return this.name
}
// èŽ·å–å•ä¾‹
Singleton.prototype.getInstance = function (name) {
  if (!this.instance) {
    this.instance = new Singleton(name)
  }
  return this.instance
}
var a = Singleton.getInstance("a")
var b = Singleton.getInstance("b")
console.log(a === b)

// é—­åŒ…å®žçŽ°
Singleton.prototype.getInstance = (function () {
  let instance = null
  return (name) => {
    if (!instance) {
      instance = new Singleton(name)
    }
    return instance
  }
})()
```

## åŽŸåž‹æ¨¡å¼

1. åœ¨åŽŸåž‹æ¨¡å¼ä¸‹ï¼Œå½“æˆ‘ä»¬æƒ³è¦åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä¼šå…ˆæ‰¾åˆ°ä¸€ä¸ªå¯¹è±¡ä½œä¸ºåŽŸåž‹ï¼Œç„¶åŽé€šè¿‡å…‹éš†åŽŸåž‹çš„æ–¹å¼æ¥åˆ›å»ºå‡ºä¸€ä¸ªä¸ŽåŽŸåž‹ä¸€æ ·ï¼ˆå…±äº«ä¸€å¥—æ•°æ®/æ–¹æ³•ï¼‰çš„å¯¹è±¡ã€‚åœ¨ JavaScript é‡Œï¼ŒObject.create æ–¹æ³•å°±æ˜¯åŽŸåž‹æ¨¡å¼çš„å¤©ç„¶å®žçŽ°â€”â€”å‡†ç¡®åœ°è¯´ï¼Œåªè¦æˆ‘ä»¬è¿˜åœ¨å€ŸåŠ© Prototype æ¥å®žçŽ°å¯¹è±¡çš„åˆ›å»ºå’ŒåŽŸåž‹çš„ç»§æ‰¿ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ˜¯åœ¨åº”ç”¨åŽŸåž‹æ¨¡å¼ã€‚

## è£…é¥°å™¨

1. è£…é¥°å™¨æ¨¡å¼ï¼Œåˆåè£…é¥°è€…æ¨¡å¼ã€‚å®ƒçš„å®šä¹‰æ˜¯â€œåœ¨ä¸æ”¹å˜åŽŸå¯¹è±¡çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡å¯¹å…¶è¿›è¡ŒåŒ…è£…æ‹“å±•ï¼Œä½¿åŽŸæœ‰å¯¹è±¡å¯ä»¥æ»¡è¶³ç”¨æˆ·çš„æ›´å¤æ‚éœ€æ±‚â€ã€‚

2. å®žçŽ°

```js
// æƒ³è±¡è¿™é‡Œæœ‰ä¸€å¨å±Žå±±ï¼Œå®ƒè™½ç„¶å®žçŽ°äº†ä¸šåŠ¡åŠŸèƒ½ï¼Œä½†ä»£ç ä¹±ä¸ƒå…«ç³Ÿ
// å¦‚æžœç›´æŽ¥ä¿®æ”¹åŽŸæ¥çš„ä»£ç ï¼Œç›´æŽ¥è¿èƒŒäº†å¼€æ”¾å°é—­åŽŸåˆ™
var falsebbb = "rld",
  aaatrue = "hel",
  shit = "lo wo",
  dsadq2 = aaatrue + shit + falsebbb
// æˆ‘ä»¬æŠŠå±Žå±±çš„é€»è¾‘æŠ½ç¦»å‡ºæ¥ï¼ŒåŒ…è£…æˆå‡½æ•°
function oldShit() {
  // å±Žå±±ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢çš„ä»£ç 
}
// è€æ¿è®©æˆ‘ä»¬åŠ ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œæˆ‘ä»¬æŠŠæ–°åŠŸèƒ½å†™åœ¨æ–°å‡½æ•°é‡Œ
function newShit() {
  // è‡ªå·±å†™çš„æ–°å±Žå±±
}
// æŠŠæ–°æ—§åŠŸèƒ½åˆå¹¶åŒ…è£…ä¸€ä¸‹
function moreShit() {
  oldShit()
  newShit()
}
// è¿™ç§â€œåªæ·»åŠ ï¼Œä¸ä¿®æ”¹â€çš„æ¨¡å¼å°±æ˜¯è£…shiå™¨æ¨¡å¼ï¼ŒnewShitå³è£…shiå™¨
// react æœ€é•¿ç”¨çš„hocå°±æ˜¯è£…é¥°å™¨çš„è¿ç”¨ï¼Œes7å·²ç»æˆä¸ºäº†æ ‡å‡†
```

## é€‚é…å™¨(adapter)

1. é€‚é…å™¨æ¨¡å¼é€šè¿‡æŠŠä¸€ä¸ªç±»çš„æŽ¥å£å˜æ¢æˆå®¢æˆ·ç«¯æ‰€æœŸå¾…çš„å¦ä¸€ç§æŽ¥å£ï¼Œå¯ä»¥å¸®æˆ‘ä»¬è§£å†³ä¸å…¼å®¹çš„é—®é¢˜ã€‚

2. é€‚é…å™¨çš„æ ¸å¿ƒâ€”â€”æŠŠå˜åŒ–ç•™ç»™è‡ªå·±ï¼ŒæŠŠç»Ÿä¸€ç•™ç»™ç”¨æˆ·ã€‚åœ¨ axios ä¸Šï¼Œæ‰€æœ‰å…³äºŽ http æ¨¡å—ã€å…³äºŽ xhr çš„å®žçŽ°ç»†èŠ‚ï¼Œå…¨éƒ¨è¢« Adapter å°è£…è¿›äº†è‡ªå·±å¤æ‚çš„åº•å±‚é€»è¾‘é‡Œï¼Œæš´éœ²ç»™ç”¨æˆ·çš„éƒ½æ˜¯ååˆ†ç®€å•çš„ç»Ÿä¸€çš„ä¸œè¥¿â€”â€”ç»Ÿä¸€çš„æŽ¥å£ï¼Œç»Ÿä¸€çš„å…¥å‚ï¼Œç»Ÿä¸€çš„å‡ºå‚ï¼Œç»Ÿä¸€çš„è§„åˆ™ã€‚

## ä»£ç†æ¨¡å¼

## è§‚å¯Ÿè€…æ¨¡å¼

- è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰äº†ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œè®©å¤šä¸ªè§‚å¯Ÿè€…å¯¹è±¡åŒæ—¶ç›‘å¬æŸä¸€ä¸ªç›®æ ‡å¯¹è±¡ï¼Œå½“è¿™ä¸ªç›®æ ‡å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡ï¼Œä½¿å®ƒä»¬èƒ½å¤Ÿè‡ªåŠ¨æ›´æ–°ã€‚

1. å‘å¸ƒè€…ç±»ï¼Œè®¢é˜…è€…

```js
// å®šä¹‰å‘å¸ƒè€…ç±»
class Publisher {
  constructor() {
    this.observers = []
    console.log("Publisher created")
  }
  // å¢žåŠ è®¢é˜…è€…
  add(observer) {
    console.log("Publisher.add invoked")
    this.observers.push(observer)
  }
  // ç§»é™¤è®¢é˜…è€…
  remove(observer) {
    console.log("Publisher.remove invoked")
    this.observers.forEach((item, i) => {
      if (item === observer) {
        this.observers.splice(i, 1)
      }
    })
  }
  // é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…
  notify() {
    console.log("Publisher.notify invoked")
    this.observers.forEach((observer) => {
      observer.update(this)
    })
  }
}

// å®šä¹‰è®¢é˜…è€…ç±»
class Observer {
  constructor() {
    console.log("Observer created")
  }

  update() {
    console.log("Observer.update invoked")
  }
}
```

2. æ‰©å±•

```js
// å®šä¹‰ä¸€ä¸ªå…·ä½“çš„éœ€æ±‚æ–‡æ¡£ï¼ˆprdï¼‰å‘å¸ƒç±»
class PrdPublisher extends Publisher {
  constructor() {
    super()
    // åˆå§‹åŒ–éœ€æ±‚æ–‡æ¡£
    this.prdState = null
    // éŸ©æ¢…æ¢…è¿˜æ²¡æœ‰æ‹‰ç¾¤ï¼Œå¼€å‘ç¾¤ç›®å‰ä¸ºç©º
    this.observers = []
    console.log("PrdPublisher created")
  }

  // è¯¥æ–¹æ³•ç”¨äºŽèŽ·å–å½“å‰çš„prdState
  getState() {
    console.log("PrdPublisher.getState invoked")
    return this.prdState
  }

  // è¯¥æ–¹æ³•ç”¨äºŽæ”¹å˜prdStateçš„å€¼
  setState(state) {
    console.log("PrdPublisher.setState invoked")
    // prdçš„å€¼å‘ç”Ÿæ”¹å˜
    this.prdState = state
    // éœ€æ±‚æ–‡æ¡£å˜æ›´ï¼Œç«‹åˆ»é€šçŸ¥æ‰€æœ‰å¼€å‘è€…
    this.notify()
  }
}

// è®¢é˜…è€…
class DeveloperObserver extends Observer {
    constructor() {
        super()
        // éœ€æ±‚æ–‡æ¡£ä¸€å¼€å§‹è¿˜ä¸å­˜åœ¨ï¼Œprdåˆå§‹ä¸ºç©ºå¯¹è±¡
        this.prdState = {}
        console.log('DeveloperObserver created')
    }

    // é‡å†™ä¸€ä¸ªå…·ä½“çš„updateæ–¹æ³•
    update(publisher) {
        console.log('DeveloperObserver.update invoked')
        // æ›´æ–°éœ€æ±‚æ–‡æ¡£
        this.prdState = publisher.getState()
        // è°ƒç”¨å·¥ä½œå‡½æ•°
        this.work()
    }

    // workæ–¹æ³•ï¼Œä¸€ä¸ªä¸“é—¨æ¬ç –çš„æ–¹æ³•
    work() {
        // èŽ·å–éœ€æ±‚æ–‡æ¡£
        const prd = this.prdState
        // å¼€å§‹åŸºäºŽéœ€æ±‚æ–‡æ¡£æä¾›çš„ä¿¡æ¯æ¬ç –ã€‚ã€‚ã€‚
        ...
        console.log('996 begins...')
    }
}

// åˆ›å»ºè®¢é˜…è€…ï¼šå‰ç«¯å¼€å‘æŽé›·
const liLei = new DeveloperObserver()
// åˆ›å»ºè®¢é˜…è€…ï¼šæœåŠ¡ç«¯å¼€å‘å°Aï¼ˆsorryã€‚ã€‚ã€‚èµ·åå­—çœŸçš„å¤ªéš¾äº†ï¼‰
const A = new DeveloperObserver()
// åˆ›å»ºè®¢é˜…è€…ï¼šæµ‹è¯•åŒå­¦å°B
const B = new DeveloperObserver()
// éŸ©æ¢…æ¢…å‡ºçŽ°äº†
const hanMeiMei = new PrdPublisher()
// éœ€æ±‚æ–‡æ¡£å‡ºçŽ°äº†
const prd = {
    // å…·ä½“çš„éœ€æ±‚å†…å®¹
    ...
}
// éŸ©æ¢…æ¢…å¼€å§‹æ‹‰ç¾¤
hanMeiMei.add(liLei)
hanMeiMei.add(A)
hanMeiMei.add(B)
// éŸ©æ¢…æ¢…å‘é€äº†éœ€æ±‚æ–‡æ¡£ï¼Œå¹¶@äº†æ‰€æœ‰äºº
hanMeiMei.setState(prd)
```

## å‘å¸ƒ - è®¢é˜…æ¨¡å¼

1. è§‚å¯Ÿè€…æ¨¡å¼ä¸Žå‘å¸ƒ-è®¢é˜…æ¨¡å¼çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

```js
// è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆæ²¡æœ‰äº‹ä»¶ä¸­å¿ƒï¼‰
// è¢«è§‚å¯Ÿè€…ï¼ˆPublisherï¼‰ -ï¼ˆé€šçŸ¥å˜åŒ–ï¼‰-> è§‚å¯Ÿè€…ï¼ˆObserverï¼‰
// è¢«è§‚å¯Ÿè€…ï¼ˆPublisherï¼‰ <-ï¼ˆè®¢é˜…äº‹ä»¶ï¼‰- è§‚å¯Ÿè€…ï¼ˆObserverï¼‰

// å‘å¸ƒ-è®¢é˜…
// å‘å¸ƒè€… -ï¼ˆé€šçŸ¥å˜åŒ–ï¼‰-> äº‹ä»¶ä¸­å¿ƒï¼ˆEventEmitterï¼‰ -ï¼ˆé€šçŸ¥å˜åŒ–ï¼‰-> è®¢é˜…è€…
// å‘å¸ƒè€… --> äº‹ä»¶ä¸­å¿ƒï¼ˆEventEmitterï¼‰ -ï¼ˆè®¢é˜…äº‹ä»¶ï¼‰-> è®¢é˜…è€…

// æ€»ç»“ï¼šå‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼Œäº‹ä»¶çš„æ³¨å†Œå’Œè§¦å‘å‘ç”Ÿåœ¨ç‹¬ç«‹äºŽåŒæ–¹çš„ç¬¬ä¸‰æ–¹å¹³å°ã€‚è§‚å¯Ÿè€…æ¨¡å¼ï¼šå‘å¸ƒè€…ä¼šç›´æŽ¥è§¦åŠåˆ°è®¢é˜…è€…ã€‚
```

2. å®žçŽ°å‘å¸ƒ-è®¢é˜…

```js
class EventEmitter {
  constructor() {
    // handlersæ˜¯ä¸€ä¸ªmapï¼Œç”¨äºŽå­˜å‚¨äº‹ä»¶ä¸Žå›žè°ƒä¹‹é—´çš„å¯¹åº”å…³ç³»
    this.handlers = {}
  }

  // onæ–¹æ³•ç”¨äºŽå®‰è£…äº‹ä»¶ç›‘å¬å™¨ï¼Œå®ƒæŽ¥å—ç›®æ ‡äº‹ä»¶åå’Œå›žè°ƒå‡½æ•°ä½œä¸ºå‚æ•°
  on(eventName, cb) {
    // å…ˆæ£€æŸ¥ä¸€ä¸‹ç›®æ ‡äº‹ä»¶åæœ‰æ²¡æœ‰å¯¹åº”çš„ç›‘å¬å‡½æ•°é˜Ÿåˆ—
    if (!this.handlers[eventName]) {
      // å¦‚æžœæ²¡æœ‰ï¼Œé‚£ä¹ˆé¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ªç›‘å¬å‡½æ•°é˜Ÿåˆ—
      this.handlers[eventName] = []
    }

    // æŠŠå›žè°ƒå‡½æ•°æŽ¨å…¥ç›®æ ‡äº‹ä»¶çš„ç›‘å¬å‡½æ•°é˜Ÿåˆ—é‡ŒåŽ»
    this.handlers[eventName].push(cb)
  }

  // emitæ–¹æ³•ç”¨äºŽè§¦å‘ç›®æ ‡äº‹ä»¶ï¼Œå®ƒæŽ¥å—äº‹ä»¶åå’Œç›‘å¬å‡½æ•°å…¥å‚ä½œä¸ºå‚æ•°
  emit(eventName, ...args) {
    // æ£€æŸ¥ç›®æ ‡äº‹ä»¶æ˜¯å¦æœ‰ç›‘å¬å‡½æ•°é˜Ÿåˆ—
    if (this.handlers[eventName]) {
      // è¿™é‡Œéœ€è¦å¯¹ this.handlers[eventName] åšä¸€æ¬¡æµ…æ‹·è´ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†é¿å…é€šè¿‡ once å®‰è£…çš„ç›‘å¬å™¨åœ¨ç§»é™¤çš„è¿‡ç¨‹ä¸­å‡ºçŽ°é¡ºåºé—®é¢˜
      const handlers = this.handlers[eventName].slice()
      // å¦‚æžœæœ‰ï¼Œåˆ™é€ä¸ªè°ƒç”¨é˜Ÿåˆ—é‡Œçš„å›žè°ƒå‡½æ•°
      handlers.forEach((callback) => {
        callback(...args)
      })
    }
  }

  // ç§»é™¤æŸä¸ªäº‹ä»¶å›žè°ƒé˜Ÿåˆ—é‡Œçš„æŒ‡å®šå›žè°ƒå‡½æ•°
  off(eventName, cb) {
    const callbacks = this.handlers[eventName]
    // cb é¿å…ä½¿ç”¨åŒ¿åå‡½æ•°
    const index = callbacks.indexOf(cb)
    if (index !== -1) {
      callbacks.splice(index, 1)
    }
  }

  // ä¸ºäº‹ä»¶æ³¨å†Œå•æ¬¡ç›‘å¬å™¨
  once(eventName, cb) {
    // å¯¹å›žè°ƒå‡½æ•°è¿›è¡ŒåŒ…è£…ï¼Œä½¿å…¶æ‰§è¡Œå®Œæ¯•è‡ªåŠ¨è¢«ç§»é™¤
    const wrapper = (...args) => {
      cb(...args)
      this.off(eventName, wrapper)
    }
    this.on(eventName, wrapper)
  }
}
```
